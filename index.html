<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <title>Test Page</title>

  <script type="text/javascript">
    (function (d, g, t, i, e, s) {
      var o = d["digities"] = d["digities"] || {};
      d[e] = d[e] || function () {
        (o.q = o.q || []).push(arguments);
      };
      var cdn_url = "https://cdn.digities.tech/AeqbSb/id-test-WEBSITE-56069748";

      s = g.createElement(t);
      s.async = true;
      s.src = cdn_url;

      s.onload = function () {
        if (window.Publisher && window.Publisher.getInstance) {
          window.Publisher.getInstance().then(function (instance) {
            o.init = function () {
              return instance;
            };

            if (o.q) {
              o.q.forEach(function (args) {
                o.init.apply(o, args);
              });
              o.q = [];
            }

            // Wait 2 seconds after SDK loads, then call window.get_dwid()
            setTimeout(function () {
              var resultElement = document.getElementById("dwid-result");
              
              function displayDwid() {
                if (window.get_dwid) {
                  try {
                    var dwid = window.get_dwid();
                    
                    // Check if it's a Promise
                    if (dwid && typeof dwid.then === 'function') {
                      dwid.then(function(result) {
                        if (resultElement) {
                          resultElement.textContent = typeof result === 'object' ? JSON.stringify(result) : result;
                        }
                      }).catch(function(error) {
                        if (resultElement) {
                          resultElement.textContent = "Error: " + error;
                        }
                      });
                    } else {
                      // It's not a Promise, display directly
                      if (resultElement) {
                        resultElement.textContent = typeof dwid === 'object' ? JSON.stringify(dwid) : dwid;
                      }
                    }
                  } catch (error) {
                    if (resultElement) {
                      resultElement.textContent = "Error calling get_dwid: " + error;
                    }
                  }
                } else {
                  // Retry after 500ms if function is not available yet
                  setTimeout(displayDwid, 500);
                }
              }
              
              displayDwid();
            }, 2000);
          });
        }
      };

      e = g.getElementsByTagName(t)[0];
      e.parentNode.insertBefore(s, e);
    })(window, document, "script", "digities");
  </script>
</head>
<body>
  <h1>PAGE : 2</h1>
  <h3 id="dwid-result"></h3>
  
</body>
</html>
